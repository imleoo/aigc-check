# AIGC-Check 实现分析报告

> 版本: v1.0
> 更新日期: 2026-01-27
> 状态: Phase 1 完成，Phase 2 进行中

---

## 1. 项目概述

AIGC-Check 是一个基于规则引擎的 AI 生成内容检测工具，通过分析文本特征来判断内容是否由 AI 生成。

### 1.1 技术架构

```
┌─────────────────────────────────────────────────────┐
│                   CLI Interface                      │
│              (cmd/aigc-check/main.go)               │
├─────────────────────────────────────────────────────┤
│                    Analyzer                          │
│            (internal/analyzer/analyzer.go)          │
├──────────────────┬──────────────────────────────────┤
│   Rule Engine    │           Scorer                  │
│  (detector/)     │         (scorer/)                │
├──────────────────┼──────────────────────────────────┤
│    10 Rules      │      5-Dimension Scoring         │
│   (rules/)       │     + Red Flag Penalties         │
├──────────────────┴──────────────────────────────────┤
│                 Text Processor                       │
│                   (text/)                           │
├─────────────────────────────────────────────────────┤
│              Configuration System                    │
│                 (config/)                           │
└─────────────────────────────────────────────────────┘
```

### 1.2 代码规模

| 模块 | 文件数 | 代码行数 | 测试覆盖 |
|------|--------|----------|----------|
| analyzer | 2 | ~200 | ✅ |
| config | 3 | ~350 | ✅ |
| detector | 2 | ~180 | ✅ |
| models | 6 | ~400 | ✅ |
| reporter | 4 | ~350 | ✅ |
| rules | 20 | ~3500 | ✅ |
| scorer | 2 | ~400 | ✅ |
| text | 2 | ~250 | ✅ |
| **总计** | **46** | **~6900** | **>80%** |

---

## 2. 当前实现的缺陷分析

### 2.1 核心缺陷：静态关键词匹配的局限性

#### 问题 1: 易被规避 (Evasion Risk)

**现象**: AI 可以通过同义词替换绕过检测

```
检测词: crucial → 替换为: important (躲避检测)
检测词: groundbreaking → 替换为: innovative (躲避检测)
检测词: Furthermore → 替换为: Also (躲避检测)
```

**影响**:
- 检测率随 AI 模型更新而下降
- 用户可以通过简单替换绕过检测
- 新版本 AI 模型可能不再使用当前检测的特征词

**解决方案**:
1. 引入同义词组检测
2. 添加统计分析层（词汇多样性、句子结构）
3. 集成 LLM 进行语义分析

#### 问题 2: 高误报率 (False Positives)

**场景示例**:

| 文本类型 | 触发规则 | 误报原因 |
|----------|----------|----------|
| 学术论文 | Signal 1, 2 | 学术写作自然使用 "Furthermore", "Additionally" |
| 技术文档 | Signal 6 | 合法使用 Markdown 语法 |
| 新闻稿 | Signal 5 | 新闻风格常用破折号 |
| 法律文件 | Signal 3 | 法律文件使用精确范围表达 |

**影响**:
- 用户信任度下降
- 需要人工复核
- 降低工具实用性

**解决方案**:
1. 引入文体识别，根据文体调整阈值
2. 添加上下文分析
3. 提供置信区间而非二元判断

#### 问题 3: 静态阈值问题

**现象**: 固定阈值无法适应不同场景

```yaml
# 当前配置
thresholds:
  high_frequency_words:
    per_1000_words: 3  # 固定阈值
```

**问题**:
- 短文本（<500词）阈值过于宽松
- 长文本（>5000词）阈值可能过于严格
- 不同语言/文体需要不同阈值

**解决方案**:
1. 动态阈值：根据文本长度调整
2. 文体适应：根据检测到的文体调整
3. 用户可配置：允许用户自定义阈值

#### 问题 4: 语义理解缺失

**示例 - Signal 3 (虚假范围)**:

```
文本: "从初学者到专家都适用"
当前检测: 匹配 "从...到..." 模式 → 标记为可疑
实际情况: 这是合理的范围表达，需要语义判断
```

**示例 - Signal 10 (完美主义)**:

```
文本: 技术文档（无需第一人称）
当前检测: 缺乏 "我认为"、"我觉得" → 标记为可疑
实际情况: 技术文档本应客观，不需要主观表达
```

**解决方案**:
1. 集成 LLM 进行语义连续性判断
2. 添加上下文理解能力
3. 引入意图识别

### 2.2 评分算法缺陷（已修复）

#### 原问题: 0分陷阱

```go
// 旧实现 - 减法扣分
total -= 50  // Signal 4
total -= 50  // Signal 8
// 结果: 100 - 50 - 50 = 0
```

#### 修复方案: 乘法递减

```go
// 新实现 - 乘法扣分
total *= 0.5  // Signal 4
total *= 0.5  // Signal 8
// 结果: 100 * 0.5 * 0.5 = 25
```

**改进效果**:
| 场景 | 旧算法 | 新算法 |
|------|--------|--------|
| 单个红旗 | 50分 | 50分 |
| 双重红旗 | 0分 | 25分 |
| 三重红旗 | 0分 | 21分 |

---

## 3. 多模态检测方案评估

### 3.1 方案架构

```
┌─────────────────────────────────────────────────────┐
│                    AIGC-Check v2.0                  │
├─────────────────────────────────────────────────────┤
│  Layer 1: 快速规则检测 (现有实现)                    │
│  ├─ 高频词检测、Markdown残留、UTM参数等              │
│  └─ 快速过滤明显AI特征                               │
│  └─ 执行时间: <100ms                                │
├─────────────────────────────────────────────────────┤
│  Layer 2: 统计分析层 (新增)                          │
│  ├─ 词汇多样性统计 (TTR - Type-Token Ratio)         │
│  ├─ 句子长度分布分析                                 │
│  └─ 文本困惑度(Perplexity)估算                      │
│  └─ 执行时间: <200ms                                │
├─────────────────────────────────────────────────────┤
│  Layer 3: LLM深度分析 (新增 - Gemini API)            │
│  ├─ 语义连续性判断 (Signal 3)                        │
│  ├─ 个人表达风格分析 (Signal 10)                     │
│  └─ 上下文一致性验证                                 │
│  └─ 执行时间: <3s                                   │
├─────────────────────────────────────────────────────┤
│  Layer 4: 集成决策器                                 │
│  └─ 多层结果加权融合 → 最终评分                      │
│  └─ 分层触发策略降低成本                            │
└─────────────────────────────────────────────────────┘
```

### 3.2 各层功能详解

#### Layer 1: 规则检测层（已实现）

| 优势 | 劣势 |
|------|------|
| 执行速度快 (<100ms) | 易被规避 |
| 无外部依赖 | 误报率较高 |
| 确定性结果 | 无语义理解 |
| 可完全离线运行 | 需要持续更新规则 |

#### Layer 2: 统计分析层（计划中）

**核心指标**:

1. **词汇多样性 (TTR)**
   - 计算公式: `TTR = 唯一词数 / 总词数`
   - AI文本特征: TTR通常较低（词汇重复度高）
   - 人类文本特征: TTR变化较大（更多口语化、个性化词汇）

2. **句子结构分析**
   - 平均句子长度
   - 句子长度方差
   - 句式复杂度（从句数量、嵌套深度）

3. **困惑度估算**
   - 基于n-gram模型估算文本困惑度
   - AI生成文本通常困惑度较低（更"流畅"）
   - 人类文本困惑度变化较大

| 优势 | 劣势 |
|------|------|
| 不依赖关键词 | 需要足够长的文本 |
| 难以规避 | 计算成本较高 |
| 可量化 | 需要训练数据校准 |

#### Layer 3: LLM深度分析（计划中）

**使用 Gemini API 实现**:

1. **语义连续性分析**
   ```
   Prompt: 分析以下文本的逻辑连贯性，判断是否存在
           不自然的范围表达或逻辑跳跃
   ```

2. **个人风格分析**
   ```
   Prompt: 分析以下文本是否包含个人特色、主观表达、
           情感倾向等人类写作特征
   ```

3. **AI特征检测**
   ```
   Prompt: 基于你对AI生成文本的了解，分析以下文本
           可能是AI生成的概率，并说明理由
   ```

| 优势 | 劣势 |
|------|------|
| 深度语义理解 | API调用成本 |
| 可解释性强 | 延迟较高 |
| 适应性强 | 依赖外部服务 |
| 可处理复杂场景 | 需要网络连接 |

### 3.3 分层触发策略

```
规则引擎检测 → 高置信度 (>0.85) → 直接输出
                  │
                  ↓ 中置信度 (0.6-0.85)
                  │
             统计分析验证 → 确认/推翻
                  │
                  ↓ 低置信度 (<0.6)
                  │
             调用 LLM 深度分析
```

**成本优化效果预估**:
- 假设 70% 文本可在 Layer 1 确定
- 假设 20% 文本需要 Layer 2 验证
- 仅 10% 文本需要 Layer 3 分析
- **API调用成本降低 90%**

### 3.4 准确率预估

| 检测模式 | 预估准确率 | 执行时间 | 成本 |
|----------|------------|----------|------|
| 仅规则引擎 | ~75% | <100ms | 免费 |
| 规则+统计 | ~85% | <300ms | 免费 |
| 多模态完整 | ~92% | <5s | API费用 |

---

## 4. 改进建议

### 4.1 短期改进（Phase 2.1-2.2）

1. **增强规则配置**
   - 添加同义词组支持
   - 实现动态阈值
   - 支持文体识别

2. **统计分析层**
   - 实现 TTR 计算
   - 实现句子结构分析
   - 实现困惑度估算

### 4.2 中期改进（Phase 2.3-2.4）

1. **Gemini API 集成**
   - 实现 API 客户端
   - 设计有效的 prompt
   - 实现结果缓存

2. **集成决策器**
   - 实现多层评分融合
   - 实现分层触发策略
   - 添加置信度输出

### 4.3 长期改进（Phase 3）

1. **机器学习模型**
   - 收集训练数据
   - 训练本地分类模型
   - 实现模型服务

2. **多模态扩展**
   - 图像 AI 检测
   - 音频 AI 检测
   - 视频 AI 检测

---

## 5. 风险评估

### 5.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| Gemini API 不可用 | 中 | 高 | 实现降级机制 |
| 统计分析误报 | 中 | 中 | 多层验证 |
| 检测规避 | 高 | 高 | 持续更新规则 |
| 准确率不达预期 | 中 | 中 | 迭代优化 |

### 5.2 成本风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| API 成本超支 | 中 | 中 | 分层触发、缓存 |
| 开发周期超预期 | 中 | 低 | 分阶段交付 |

---

## 6. 里程碑

### Phase 1 (已完成) ✅

- [x] Go模块初始化
- [x] 所有核心类型定义
- [x] 配置系统工作
- [x] 基础CLI结构
- [x] 所有10个规则实现
- [x] 规则引擎执行所有规则
- [x] 每个规则有单元测试
- [x] CLI工具完成
- [x] 文本和JSON输出格式
- [x] 单元测试覆盖率>80%

### Phase 2.1 (进行中) 🔄

- [x] 修复评分算法0分问题
- [x] 实现乘法递减扣分机制
- [x] 添加最低保底分数
- [ ] 增强规则配置(同义词组)

### Phase 2.2 (待开始)

- [ ] 统计分析层实现
- [ ] TTR 计算
- [ ] 句子结构分析
- [ ] 困惑度估算

### Phase 2.3-2.5 (待开始)

- [ ] Gemini API 集成
- [ ] 集成决策器
- [ ] CLI 和文档更新

---

## 7. 附录

### 7.1 评分算法数学说明

**旧算法（减法扣分）**:
```
Score = BaseScore - Σ(Penalty_i)
问题: Score 可能为负数或0
```

**新算法（乘法递减）**:
```
Score = BaseScore × Π(Factor_i)
其中: Factor_i = 1 - (1 - BaseFactor) × Severity_i

特性:
- 永远不会为0（除非 BaseFactor = 0）
- 递减效果：第一个红旗影响大，后续影响递减
- 保底机制：Score >= MinimumScore (5分)
```

### 7.2 配置文件结构

```yaml
# configs/aigc-check.yaml
thresholds:
  high_frequency_words:
    per_1000_words: 3
    word_groups:  # 计划中
      - [crucial, critical, vital, essential]

scoring:
  weights:
    vocabulary_diversity: 20.0
    sentence_complexity: 15.0
    personalization: 25.0
    logical_coherence: 20.0
    emotional_authenticity: 20.0

# 计划中
gemini:
  enabled: false
  api_key: ""
  model: "gemini-pro"
  temperature: 0.3
```

### 7.3 相关文件

| 文件 | 说明 |
|------|------|
| `internal/scorer/calculator.go` | 评分计算核心 |
| `internal/rules/signal*.go` | 10个检测规则 |
| `internal/config/config.go` | 配置管理 |
| `configs/aigc-check.yaml` | 默认配置 |
| `docs/需求文档.md` | 需求规格 |

---

*报告生成日期: 2026-01-27*
